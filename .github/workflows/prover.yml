name: Lean Prover CI

on:
  push:
    branches: [ "main" ]
    paths:
      - 'proofs/**'
      - 'lakefile.lean'
      - 'lean-toolchain'
      - '.github/workflows/prover.yml'
  pull_request:
    branches: [ "main" ]
    paths:
      - 'proofs/**'
      - 'lakefile.lean'
      - 'lean-toolchain'
      - '.github/workflows/prover.yml'
  workflow_dispatch:

jobs:
  prove:
    runs-on: ubuntu-latest
    container:
      image: leanprovercommunity/mathlib:latest
    timeout-minutes: 5
    
    steps:
      - name: Check out repository
        uses: actions/checkout@v4
        
      - name: Build and prove
        run: |
          # Mathlib is already installed in the container!
          # Just build our files
          lake build Calibrator --no-cache
